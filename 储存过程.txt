CREATE PROCEDURE procedure_register
(
     @account    VARCHAR(50),
     @password VARCHAR(50),
     @userid  int  output
)
 AS 
IF EXISTS(SELECT * FROM account WHERE user_id=@userid)--先判断用户是否存在
BEGIN
SELECT @userid=-1 --如果存在则返回-1
END
ELSE --如果不存在则执行注册插入
BEGIN
INSERT INTO  account
(
      user_id,
      account,
      password,
)
VALUES
(
      @userid,
      @account,
      @password,
)
SELECT
     @accountid =SCOPE_IDENTITY()--获取刚注册分配的账号id
FROM account

END
GO





CREATE PROCEDURE procedure_appointment
(
     @user_id    INT(10),
     @room_id  INT(10),
     @begin_time datetime,
     @end_time datetime,
)
 AS 
IF EXISTS(SELECT * FROM appointment WHERE room_id=@room_id AND begin_time = @begin_time)--先判断预约是否冲突
BEGIN
SELECT @room_id=-1 --如果存在则返回-1
END
ELSE --如果不存在则执行注册插入
BEGIN
INSERT INTO  appointment
   user_id,
   room_id,
   begin_time,
   end_time,
   sign_in_status,

)
VALUES
(
      @user_id,
      @room_id,
      @begin_time,
      @end_time,
      0,               --状态默认值为0
)


END
GO









CREATE PROCEDURE procedure_store
(
     @user_id    INT(10),
     @locker_id  INT(10),
     @time_put_in datetime,
     @duration timestamp,
)
 AS 
IF EXISTS(SELECT * FROM appointment WHERE locker_id=@locker_id AND time_put_in = @time_put_in)--先判断行为是否冲突
BEGIN
SELECT @locker_id=-1 --如果存在则返回-1
END
ELSE --如果不存在则执行注册插入
BEGIN
INSERT INTO  account
(
   user_id,
   locker_id,
   time_put_in,
   duration,

)
VALUES
(
   @user_id,
   @locker_id,
   @time_put_in,
   @duration,
)


END
GO